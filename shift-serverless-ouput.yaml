AWSTemplateFormatVersion: '2010-09-09'
Description: Shifty serverless back-end logic.
Resources:
  AuthLoginLogic:
    Properties:
      CodeUri: s3://shifty-back-end/back_end.zip
      Description: Login logic for Shifty application.
      Events:
        Shifty:
          Properties:
            Method: post
            Path: /login
          Type: Api
      Handler: auth_login.lambda_handler
      MemorySize: 512
      Policies:
      - Statement:
        - Action:
          - dynamodb:GetItem
          Effect: Allow
          Resource:
            Fn::Join:
            - ''
            - - 'arn:aws:dynamodb:'
              - Ref: AWS::Region
              - ':'
              - Ref: AWS::AccountId
              - :table/*
        Version: '2012-10-17'
      Runtime: python3.6
      Timeout: 10
    Type: AWS::Serverless::Function
  AuthRegistrationLogic:
    Properties:
      CodeUri: s3://shifty-back-end/back_end.zip
      Description: Registration logic for Shifty application.
      Events:
        Shifty:
          Properties:
            Method: post
            Path: /register/company
          Type: Api
      Handler: auth_register.lambda_handler
      MemorySize: 512
      Policies:
      - Statement:
        - Action:
          - dynamodb:PutItem
          - dynamodb:CreateTable
          - dynamodb:DescribeTable
          Effect: Allow
          Resource:
            Fn::Join:
            - ''
            - - 'arn:aws:dynamodb:'
              - Ref: AWS::Region
              - ':'
              - Ref: AWS::AccountId
              - :table/*
        Version: '2012-10-17'
      Runtime: python3.6
      Timeout: 20
    Type: AWS::Serverless::Function
  ShiftCRUDLogic:
    Properties:
      CodeUri: s3://shifty-back-end/back_end.zip
      Description: CRUD logic for Shifts.
      Events:
        Shifty:
          Properties:
            Method: ANY
            Path: /api/shifts
          Type: Api
      Handler: api_shift_crud.lambda_handler
      MemorySize: 512
      Policies:
      - Statement:
        - Action:
            - 'dynamodb:DeleteItem'
            - 'dynamodb:GetItem'
            - 'dynamodb:PutItem'
            - 'dynamodb:Scan'
            - 'dynamodb:UpdateItem'
          Effect: Allow
          Resource:
            Fn::Join:
            - ''
            - - 'arn:aws:dynamodb:'
              - Ref: AWS::Region
              - ':'
              - Ref: AWS::AccountId
              - :table/*
        Version: '2012-10-17'
      Runtime: python3.6
      Timeout: 10
    Type: AWS::Serverless::Function
  TradeCRUDLogic:
    Properties:
      CodeUri: s3://shifty-back-end/back_end.zip
      Description: CRUD logic for trades.
      Events:
        Shifty:
          Properties:
            Method: ANY
            Path: /api/trades
          Type: Api
      Handler: api_trade_crud.lambda_handler
      MemorySize: 512
      Policies:
      - Statement:
        - Action:
            - 'dynamodb:DeleteItem'
            - 'dynamodb:GetItem'
            - 'dynamodb:PutItem'
            - 'dynamodb:Scan'
            - 'dynamodb:UpdateItem'
          Effect: Allow
          Resource:
            Fn::Join:
            - ''
            - - 'arn:aws:dynamodb:'
              - Ref: AWS::Region
              - ':'
              - Ref: AWS::AccountId
              - :table/*
        Version: '2012-10-17'
      Runtime: python3.6
      Timeout: 10
    Type: AWS::Serverless::Function
  CustomAuthLogic:
    Properties:
      CodeUri: s3://shifty-back-end/back_end.zip
      Description: Custom authorizer for Shifty API, implemented in Python 3.6.
      Handler: authorizer.lambda_handler
      MemorySize: 256
      Policies:
      - Statement:
        - Action:
          - dynamodb:DeleteItem
          - dynamodb:GetItem
          - dynamodb:PutItem
          - dynamodb:Scan
          - dynamodb:UpdateItem
          Effect: Allow
          Resource:
            Fn::Join:
            - ''
            - - 'arn:aws:dynamodb:'
              - Ref: AWS::Region
              - ':'
              - Ref: AWS::AccountId
              - :table/*
        Version: '2012-10-17'
      Runtime: python3.6
      Timeout: 5
    Type: AWS::Serverless::Function
Transform: AWS::Serverless-2016-10-31
